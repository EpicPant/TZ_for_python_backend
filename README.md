# TZ_for_python_backend
Mini-CRM для распределения лидов между операторами

Запуск:
1. pip install -r requirements.txt
2. uvicorn app.main:app --reload

Модель данных:
- Lead — клиент. Идентифицируется по email, phone или external_id.
- Source — источник (бот). Имеет уникальное имя.
- Operator — оператор. Имеет флаг активности (is_active) и лимит активных обращений (max_load).
- OperatorSourceConfig — связь оператора с источником и вес (компетенция).
- Ticket — обращение. Имеет статус; "open" означает активное.

Логика распределения:
При создании обращения:
1. Система находит или создаёт лида по email/phone/external_id.
2. Выбирает оператора для заданного источника:
   - только активные операторы;
   - текущее число обращений со статусом "open" не превышает max_load;
   - выбор происходит случайно с вероятностью = вес оператора / сумма весов.
3. Если подходящих операторов нет, обращение создаётся без оператора.

API:
- POST /sources/ — создать источник
- POST /operators/ — создать оператора
- PATCH /operators/{id} — обновить активность или лимит
- POST /operators/assign-to-source?operator_id=...&source_id=...&weight=... — настроить распределение
- POST /tickets/ — создать обращение
- GET /leads/ — список лидов

Технологии: FastAPI, SQLAlchemy 2.0 (асинхронный режим), SQLite, Alembic.